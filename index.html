<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ContextSheet - AI for Google Sheets</title>
    <meta
      name="description"
      content="ContextSheet brings the power of large language models (Gemini, Claude, ChatGPT) and Google Drive context directly into your Google Sheets."
    />
    <link rel="icon" href="images/logo_small.png" type="image/png" />
    <style>
      /* Reset & Base */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; /* Sans-serif for body */
        line-height: 1.6;
        color: #333;
        background-color: #ffffff; /* White background */
        padding-top: 80px; /* Space for fixed header */
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      .container {
        max-width: 1100px; /* Wider container for grid */
        margin: 20px auto; /* Add top margin */
        padding: 0 20px; /* Padding on sides */
        flex-grow: 1;
        width: 100%;
      }

      /* Header */
      header {
        background-color: #ffffff;
        border-bottom: 1px solid #eee;
        position: fixed; /* Fixed header */
        top: 0;
        left: 0;
        width: 100%;
        z-index: 1000;
        padding: 15px 0;
      }

      nav {
        max-width: 1100px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 50px; /* Fixed height for alignment */
      }

      .nav-left ul {
        list-style: none;
        display: flex;
        gap: 25px; /* Increased gap */
      }

      .nav-left a {
        text-decoration: none;
        color: #555;
        font-size: 0.95em;
        letter-spacing: 0.5px;
        padding-bottom: 3px;
        border-bottom: 2px solid transparent;
        transition: color 0.2s ease, border-color 0.2s ease;
      }

      .nav-left a:hover,
      .nav-left a.active {
        color: #000;
        border-bottom-color: #aaa;
      }

      .nav-center {
        font-family: "Times New Roman", Times, serif; /* Serif font for title */
        color: #222;
        position: absolute; /* Center absolutely */
        left: 50%;
        transform: translateX(-50%);
        height: 100%; /* Take full nav height */
        display: flex; /* Use flex to center image */
        align-items: center;
        justify-content: center;
      }
      .nav-center a {
        /* Style the link containing the image */
        color: inherit;
        text-decoration: none;
        height: 80%; /* Increased from 60% to make logo larger */
        display: flex; /* Align image within link */
        align-items: center;
      }
      .nav-center img {
        height: 100%; /* Make image fill link height */
        width: auto; /* Maintain aspect ratio */
      }

      /* Main Content Sections */
      main section {
        padding: 20px 0; /* Padding top/bottom */
      }

      /* Home Page Specifics */
      #home-content h1 {
        text-align: center;
        font-family: "Times New Roman", Times, serif;
        font-weight: normal;
        font-size: 1.5em;
        margin-bottom: 30px;
        color: #444;
      }
      #home-content > p {
        /* Style the intro paragraph */
        text-align: center;
        max-width: 700px;
        margin: 0 auto 40px auto; /* Center block and add bottom margin */
        color: #555;
        font-size: 1.05em;
      }

      /* Split Showcase (Replaces Media Carousel) */
      .split-showcase {
        display: flex;
        gap: 30px; /* Gap between video and images */
        margin: 0 auto 40px auto;
        max-width: 1100px; /* Adjust max-width if needed */
        align-items: flex-start; /* Align items to the top */
      }

      .showcase-left,
      .showcase-right {
        flex: 1; /* Each takes half the space */
        position: relative; /* Needed for captions/arrows */
        display: flex;
        flex-direction: column;
        align-items: center; /* Center content horizontally */
      }

      .showcase-left .media,
      .showcase-right .media {
        display: block;
        width: 100%;
        height: auto;
        border: 1px solid #eee;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        margin-bottom: 15px; /* Space for caption */
      }
      .showcase-left video.media {
        background-color: #f0f0f0;
      }

      .showcase-left .caption,
      .showcase-right .caption {
        font-family: "Times New Roman", Times, serif;
        font-size: 1em;
        color: #444;
        text-decoration: underline;
        text-decoration-thickness: 1px;
        text-underline-offset: 3px;
        text-align: center;
        width: 100%; /* Ensure caption takes full width */
      }

      /* Image Carousel specific styles within showcase-right */
      .image-carousel-container {
        position: relative;
        width: 100%;
        min-height: 350px; /* Estimate height or use aspect-ratio */
        overflow: hidden;
      }

      .image-carousel-container .media-item {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.6s ease-in-out;
        display: flex;
        flex-direction: column; /* Stack media and caption */
        justify-content: center; /* Center content vertically */
        align-items: center;
      }

      .image-carousel-container .media-item.active {
        opacity: 1;
        visibility: visible;
        z-index: 1;
      }

      /* Adjust media height within the right carousel */
      .image-carousel-container .media-item .media {
        max-height: calc(100% - 40px); /* Leave space for caption */
      }

      /* Adjust caption position within right carousel items */
      .image-carousel-container .media-item .caption {
        position: absolute;
        bottom: 10px;
        left: 0;
        z-index: 2;
      }

      /* Reposition Carousel Navigation Arrows */
      .carousel-btn {
        position: absolute;
        top: 50%;
        /* Adjust transform based on media height, maybe slightly lower */
        transform: translateY(-60%);
        background-color: rgba(0, 0, 0, 0.4);
        color: white;
        border: none;
        border-radius: 50%;
        width: 35px; /* Slightly smaller arrows */
        height: 35px;
        font-size: 18px;
        cursor: pointer;
        z-index: 5; /* Ensure buttons are on top */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s ease;
      }
      .carousel-btn:hover {
        background-color: rgba(0, 0, 0, 0.7);
      }
      /* Position arrows relative to showcase-right */
      .showcase-right .carousel-btn.prev-btn {
        left: 15px;
      }
      .showcase-right .carousel-btn.next-btn {
        right: 15px;
      }

      /* About Page Specifics */
      #about-content {
        max-width: 800px; /* Narrower content for text */
        margin: 0 auto; /* Center the about content */
      }

      #about-content h1,
      #about-content h2 {
        font-family: "Times New Roman", Times, serif;
        font-weight: normal;
        color: #333;
        border-bottom: 1px solid #eee;
        padding-bottom: 5px;
        margin-bottom: 15px;
        margin-top: 30px;
      }
      #about-content h1 {
        font-size: 1.8em;
        text-align: center;
        border-bottom: none; /* No border for main H1 */
        margin-bottom: 25px;
      }
      #about-content h2 {
        font-size: 1.4em;
        margin-top: 40px;
      }

      #about-content p,
      #about-content ul {
        margin-bottom: 15px;
        color: #555;
        font-size: 0.95em;
      }
      #about-content ul {
        margin-left: 20px;
        list-style: disc; /* Use standard bullets */
      }
      #about-content li {
        margin-bottom: 8px;
      }
      #about-content strong {
        color: #111; /* Make strong text darker */
        font-weight: 600;
      }
      #about-content a {
        /* Style links within about page */
        color: #0056b3; /* Standard link blue */
        text-decoration: none;
      }
      #about-content a:hover {
        text-decoration: underline;
      }

      /* Buttons (Keep for About page, slightly simplified) */
      .button {
        display: inline-block;
        background-color: #444; /* Darker button */
        color: #ffffff;
        padding: 8px 18px;
        text-decoration: none;
        border-radius: 3px;
        font-weight: normal; /* Normal weight */
        font-size: 0.9em;
        transition: background-color 0.2s ease;
        border: none;
        cursor: pointer;
        margin-right: 10px;
        margin-top: 10px;
      }
      .button:hover {
        background-color: #222; /* Darker hover */
      }
      .button.secondary {
        background-color: #f0f0f0; /* Light grey */
        color: #333;
        border: 1px solid #ddd;
      }
      .button.secondary:hover {
        background-color: #e0e0e0;
      }

      /* Footer */
      footer {
        text-align: center;
        margin-top: 50px; /* More space above footer */
        padding: 25px 20px;
        font-size: 0.85em;
        color: #888; /* Lighter footer text */
        border-top: 1px solid #eee;
        background-color: #ffffff;
      }
      footer a {
        color: #666; /* Slightly darker link */
        text-decoration: none;
      }
      footer a:hover {
        text-decoration: underline;
      }

      /* Utility */
      .hidden {
        display: none;
      }

      /* Responsive */
      @media (max-width: 768px) {
        body {
          padding-top: 100px; /* Adjust for potentially taller header */
        }
        nav {
          flex-direction: column;
          height: auto; /* Auto height */
          padding: 10px 20px;
        }
        .nav-center {
          position: static; /* Remove absolute positioning */
          transform: none;
          margin-bottom: 10px; /* Space below title */
          order: -1; /* Place title first */
          font-size: 1.6em;
        }
        .nav-left {
          width: 100%;
          display: flex;
          justify-content: center; /* Center nav links */
        }
        .nav-left ul {
          padding: 0;
          gap: 20px;
        }

        .split-showcase {
          flex-direction: column;
          gap: 30px;
        }
        .showcase-left .media {
          max-height: 250px; /* Adjust height for smaller screens */
        }
      }

      @media (max-width: 480px) {
        body {
          font-size: 15px; /* Slightly smaller base font */
        }
        .nav-center {
          font-size: 1.4em;
        }
        .nav-left a {
          font-size: 0.9em;
        }
        #home-content h1 {
          font-size: 1.3em;
        }
        #home-content > p {
          font-size: 1em;
        }
        #about-content h1 {
          font-size: 1.6em;
        }
        #about-content h2 {
          font-size: 1.2em;
        }
      }

      /* Upcoming Features Section */
      .upcoming-features {
        margin-top: 60px;
        padding-top: 30px;
        border-top: 1px solid #eee;
      }

      .upcoming-features h2 {
        font-family: "Times New Roman", Times, serif;
        font-weight: normal;
        text-align: center;
        font-size: 1.5em;
        margin-bottom: 30px;
        color: #444;
      }

      .feature-list {
        display: flex;
        flex-direction: column;
        gap: 25px;
        max-width: 600px;
        margin: 0 auto;
      }

      .feature-item {
        display: flex;
        align-items: center;
        gap: 15px;
        cursor: pointer; /* Indicate clickability for voting */
        padding: 5px 0; /* Add some padding for easier clicking */
      }

      .feature-name {
        flex-basis: 150px; /* Fixed width for names */
        flex-shrink: 0;
        text-align: right;
        font-size: 0.95em;
        color: #333;
      }

      .feature-bar-container {
        flex-grow: 1;
        height: 15px; /* Height of the bar area */
        position: relative;
      }

      .feature-bar {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        background-color: #ccc; /* Default/fallback color */
        border-radius: 8px; /* Rounded bar */
        display: flex; /* To position the end circle */
        align-items: center;
        justify-content: flex-end; /* Position circle at the end */
        transition: width 0.3s ease-in-out; /* Animate width changes */
      }

      .feature-bar-end {
        width: 25px; /* Diameter of the circle */
        height: 25px;
        background-color: inherit; /* Match bar color */
        border-radius: 50%;
        position: absolute;
        right: -12.5px; /* Center the circle on the bar end */
        top: 50%;
        transform: translateY(-50%);
        border: 2px solid white; /* Optional: small white border around circle */
        box-shadow: 0 0 3px rgba(0, 0, 0, 0.2);
      }

      /* Feature specific colors */
      .feature-item[data-feature-id="ocr"] .feature-bar,
      .feature-item[data-feature-id="ocr"] .feature-bar-end {
        background-color: #1f78b4; /* Blue */
      }
      .feature-item[data-feature-id="claude"] .feature-bar,
      .feature-item[data-feature-id="claude"] .feature-bar-end {
        background-color: #ff7f00; /* Orange */
      }
      .feature-item[data-feature-id="pdf"] .feature-bar,
      .feature-item[data-feature-id="pdf"] .feature-bar-end {
        background-color: #33a02c; /* Green */
      }
      .feature-item[data-feature-id="new"] .feature-bar,
      .feature-item[data-feature-id="new"] .feature-bar-end {
        background-color: #6a3d9a; /* Purple for new features */
      }

      .feature-votes {
        font-size: 0.9em;
        color: #666;
        min-width: 30px; /* Ensure space for votes */
        text-align: left;
      }

      /* Add Feature Form */
      .add-feature-form {
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px dashed #ddd;
        display: flex;
        gap: 10px;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }

      .add-feature-form input[type="text"] {
        flex-grow: 1;
        padding: 8px 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
        font-size: 0.9em;
      }

      .add-feature-form button {
        padding: 8px 15px;
        background-color: #555;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 0.9em;
        transition: background-color 0.2s ease;
      }
      .add-feature-form button:hover {
        background-color: #333;
      }
    </style>
  </head>
  <body>
    <header>
      <nav>
        <div class="nav-left">
          <ul>
            <li>
              <a
                href="#"
                id="nav-home"
                class="nav-link active"
                onclick="showPage('home-content'); return false;"
                >Home</a
              >
            </li>
            <li>
              <a
                href="#"
                id="nav-about"
                class="nav-link"
                onclick="showPage('about-content'); return false;"
                >About</a
              >
            </li>
          </ul>
        </div>
        <div class="nav-center">
          <a href="#" onclick="showPage('home-content'); return false;">
            <img src="images/logo.png" alt="ContextSheet Logo" />
          </a>
        </div>
        <!-- Right navigation can be added here if needed -->
      </nav>
    </header>

    <main class="container">
      <!-- Home Page Content -->
      <section id="home-content">
        <!-- Removed H1 from here, using centered paragraph -->
        <p>
          ContextSheet is a Google Sheets™ Add-on connecting spreadsheets to
          LLMs (Gemini, Claude, ChatGPT) and Google Drive™ for contextual
          answers.
        </p>

        <!-- Replaced media-carousel with split-showcase -->
        <div class="split-showcase">
          <div class="showcase-left">
            <video controls autoplay muted loop playsinline class="media">
              <source src="images/video.mp4" type="video/mp4" />
              Your browser does not support the video tag.
            </video>
            <div class="caption">Demo Video</div>
          </div>
          <div class="showcase-right">
            <div class="image-carousel-container">
              <!-- Image items for the carousel -->
              <div class="media-item active">
                <!-- Start with first image active -->
                <img
                  src="images/main_page.png"
                  alt="ContextSheet Main Interface"
                  class="media"
                />
                <div class="caption">Main Interface</div>
              </div>
              <div class="media-item">
                <img
                  src="images/response.png"
                  alt="ContextSheet Response Example"
                  class="media"
                />
                <div class="caption">Example Response</div>
              </div>
              <!-- Add more image items here if needed -->

              <!-- Navigation Arrows for Image Carousel -->
              <button class="carousel-btn prev-btn" aria-label="Previous Image">
                &#10094;
              </button>
              <button class="carousel-btn next-btn" aria-label="Next Image">
                &#10095;
              </button>
            </div>
          </div>
        </div>

        <!-- Upcoming Features Section -->
        <div class="upcoming-features">
          <h2>Upcoming Features</h2>
          <div class="feature-list">
            <!-- Feature items will be loaded here by JS or statically -->
            <div class="feature-item" data-feature-id="ocr" data-votes="75">
              <span class="feature-name">OCR Scanning</span>
              <div class="feature-bar-container">
                <div class="feature-bar" style="width: 75%">
                  <div class="feature-bar-end"></div>
                </div>
              </div>
              <span class="feature-votes">75</span>
            </div>
            <div class="feature-item" data-feature-id="claude" data-votes="55">
              <span class="feature-name">Claude Sonnet 3.5</span>
              <div class="feature-bar-container">
                <div class="feature-bar" style="width: 55%">
                  <div class="feature-bar-end"></div>
                </div>
              </div>
              <span class="feature-votes">55</span>
            </div>
            <div class="feature-item" data-feature-id="pdf" data-votes="40">
              <span class="feature-name">Advanced PDF Parsing</span>
              <div class="feature-bar-container">
                <div class="feature-bar" style="width: 40%">
                  <div class="feature-bar-end"></div>
                </div>
              </div>
              <span class="feature-votes">40</span>
            </div>
          </div>

          <form class="add-feature-form">
            <input
              type="text"
              placeholder="Suggest a new feature..."
              required
            />
            <button type="submit">Add Feature</button>
          </form>
        </div>
        <!-- End Upcoming Features -->
      </section>

      <!-- About Page Content -->
      <section id="about-content" class="hidden">
        <h1>About ContextSheet</h1>
        <p>Hi there! I'm [Your Name/Alias], the creator of ContextSheet.</p>
        <p>
          I built ContextSheet because I wanted a seamless way to integrate the
          reasoning power of modern LLMs directly into my Google Sheets
          workflows. Manually copying data between spreadsheets and AI chat
          interfaces, especially when needing context from Drive documents, felt
          inefficient.
        </p>
        <p>
          This add-on aims to bridge that gap, leveraging Google Apps Script to
          connect Sheets, Drive, and various LLM APIs (Gemini, Claude via
          Anthropic/Bedrock, and OpenAI). It incorporates features like document
          ranking and context management to provide more relevant answers
          directly within the spreadsheet environment.
        </p>

        <!-- Moved Features Here -->
        <h2>Key Features</h2>
        <ul>
          <li>
            <strong>Connect to Leading LLMs:</strong> Seamlessly switch between
            Google Gemini (Flash, Pro), Anthropic Claude (Haiku, Sonnet - Direct
            & Bedrock), and OpenAI ChatGPT (GPT-4o mini, GPT-4.1).
          </li>
          <li>
            <strong>Google Drive Context:</strong> Use specific Google Drive
            files (Docs, Sheets, Slides, PDFs) or entire folders as context for
            your AI queries.
          </li>
          <li>
            <strong>Intelligent Search:</strong> ContextSheet ranks potential
            context documents based on keyword relevance, recency preferences,
            and query analysis.
          </li>
          <li>
            <strong>Cell-Based Processing:</strong> Run AI queries on data
            directly from selected cells or ranges.
          </li>
          <li>
            <strong>Customizable AI Behavior:</strong> Fine-tune how
            ContextSheet retrieves and uses context (Snippets vs. Full Docs,
            Title vs. Content focus).
          </li>
          <li>
            <strong>Direct Insertion:</strong> Insert AI-generated answers back
            into your spreadsheet cells or columns.
          </li>
          <li>
            <strong>Sidebar Interface:</strong> Manage API keys, context
            settings, and run queries easily through the integrated sidebar.
          </li>
        </ul>

        <!-- Moved Get Started Here -->
        <h2>Get Started</h2>
        <p>
          Install ContextSheet and start automating your data analysis and
          information retrieval workflows.
        </p>
        <a
          href="[YOUR_GOOGLE_WORKSPACE_MARKETPLACE_LINK_HERE]"
          target="_blank"
          rel="noopener noreferrer"
          class="button"
          >Install from Marketplace</a
        >
        <a
          href="https://github.com/[YOUR_GITHUB_USERNAME]/[YOUR_REPOSITORY_NAME]"
          target="_blank"
          rel="noopener noreferrer"
          class="button secondary"
          >View on GitHub</a
        >
        <p>
          <small
            >Note: ContextSheet requires API keys for the respective AI services
            (Gemini, Claude, OpenAI). API usage costs are billed directly by the
            AI providers.</small
          >
        </p>

        <h2>Open Source</h2>
        <p>
          ContextSheet is an open-source project. You can find the source code,
          report issues, or contribute on GitHub.
        </p>
        <a
          href="https://github.com/[YOUR_GITHUB_USERNAME]/[YOUR_REPOSITORY_NAME]"
          target="_blank"
          rel="noopener noreferrer"
          class="button secondary"
          >ContextSheet on GitHub</a
        >

        <h2>Connect</h2>
        <p>Feel free to connect with me:</p>
        <ul>
          <li>
            <strong>GitHub:</strong>
            <a
              href="https://github.com/[YOUR_GITHUB_USERNAME]"
              target="_blank"
              rel="noopener noreferrer"
              >@[YOUR_GITHUB_USERNAME]</a
            >
          </li>
          <li>
            <strong>LinkedIn:</strong>
            <a
              href="[YOUR_LINKEDIN_URL_HERE]"
              target="_blank"
              rel="noopener noreferrer"
              >Your Name</a
            >
            (Optional)
          </li>
          <li>
            <strong>Website:</strong>
            <a
              href="[YOUR_PERSONAL_WEBSITE_URL_HERE]"
              target="_blank"
              rel="noopener noreferrer"
              >yourwebsite.com</a
            >
            (Optional)
          </li>
        </ul>

        <h2>Disclaimer</h2>
        <p>
          ContextSheet interacts with third-party AI services. You are
          responsible for managing your own API keys and any associated costs
          incurred from using these services (Google Gemini, Anthropic Claude,
          OpenAI ChatGPT). Please review the terms and pricing of each service
          provider.
        </p>
      </section>
    </main>

    <footer>
      © <span id="copyright-year"></span> [Your Name/Alias or ContextSheet] |
      <a
        href="https://github.com/[YOUR_GITHUB_USERNAME]/[YOUR_REPOSITORY_NAME]"
        target="_blank"
        rel="noopener noreferrer"
        >GitHub Repository</a
      >
      <!-- Add Privacy Policy/Terms links here if applicable -->
    </footer>

    <script>
      // Simple SPA Logic (Mostly unchanged, removed slideshow parts)
      const pages = ["home-content", "about-content"];
      const navLinks = document.querySelectorAll(".nav-link"); // Assuming class '.nav-link' is kept on nav items

      function showPage(pageIdToShow) {
        pages.forEach((pageId) => {
          const pageElement = document.getElementById(pageId);
          if (pageElement) {
            pageElement.classList.add("hidden");
          }
        });

        const targetPage = document.getElementById(pageIdToShow);
        if (targetPage) {
          targetPage.classList.remove("hidden");
        }

        // Update active nav link
        navLinks.forEach((link) => {
          link.classList.remove("active");
          // More robust check based on the target page ID
          if (link.id === `nav-${pageIdToShow.split("-")[0]}`) {
            link.classList.add("active");
          }
        });

        window.scrollTo(0, 0); // Scroll to top
      }

      // Set current year in footer
      const yearSpan = document.getElementById("copyright-year");
      if (yearSpan) {
        yearSpan.textContent = new Date().getFullYear();
      }

      // Initial setup: Show the home page by default
      document.addEventListener("DOMContentLoaded", () => {
        showPage("home-content");
        // Add any other initialization if needed
      });

      // Re-add event listeners for nav links if needed (or ensure onclick works)
      // Example:
      // document.getElementById('nav-home').addEventListener('click', (e) => { e.preventDefault(); showPage('home-content'); });
      // document.getElementById('nav-about').addEventListener('click', (e) => { e.preventDefault(); showPage('about-content'); });
      // The onclick attributes in the HTML should suffice here.

      // --- Media Carousel Logic (Now targets only images on right) ---
      const imageCarouselContainer = document.querySelector(
        ".image-carousel-container"
      );
      if (imageCarouselContainer) {
        const items = imageCarouselContainer.querySelectorAll(".media-item");
        const prevBtn = imageCarouselContainer.querySelector(".prev-btn"); // Look within the container
        const nextBtn = imageCarouselContainer.querySelector(".next-btn"); // Look within the container
        let currentIndex = 0;
        let intervalId = null;
        const slideDuration = 10000; // 10 seconds

        function showItem(index) {
          // Remove active class from all items
          items.forEach((item) => item.classList.remove("active"));

          // Add active class to the target item
          items[index].classList.add("active");
          // No need to handle video play/pause here anymore
        }

        function nextItem() {
          currentIndex = (currentIndex + 1) % items.length;
          showItem(currentIndex);
          // Reset timer on automatic next
          startCarousel();
        }

        function prevItem() {
          currentIndex = (currentIndex - 1 + items.length) % items.length;
          showItem(currentIndex);
          // Reset timer on manual prev
          startCarousel();
        }

        function startCarousel() {
          // Clear existing interval just in case
          clearInterval(intervalId);
          // Start new interval
          intervalId = setInterval(nextItem, slideDuration);
        }

        // Event Listeners for buttons
        if (prevBtn && items.length > 1) {
          // Only add listener if multiple items
          prevBtn.addEventListener("click", () => {
            prevItem();
            // prevItem now resets timer
          });
        }
        if (nextBtn && items.length > 1) {
          // Only add listener if multiple items
          nextBtn.addEventListener("click", () => {
            nextItem();
            // nextItem now resets timer
          });
        }

        // Initialize
        if (items.length > 1) {
          // Only start carousel if there's more than one item
          showItem(currentIndex); // Show initial item
          startCarousel(); // Start automatic cycling
        } else if (items.length === 1) {
          showItem(0); // Show the single item if only one exists
        }
      }
      // --- End Media Carousel Logic ---

      // --- Local Storage Enhanced Features Logic ---
      const STORAGE_KEY = "contextsheetFeatures";
      const featureListContainer = document.querySelector(".feature-list");
      const addFeatureFormElement = document.querySelector(".add-feature-form");
      const addFeatureInput =
        addFeatureFormElement?.querySelector('input[type="text"]');
      const addFeatureButton = addFeatureFormElement?.querySelector("button");

      // Default features if nothing in storage
      const defaultFeatures = {
        ocr: { name: "OCR Scanning", votes: 75 },
        claude: { name: "Claude Sonnet 3.5", votes: 55 },
        pdf: { name: "Advanced PDF Parsing", votes: 40 },
      };

      // Load initial state from localStorage or set defaults
      function loadState() {
        const storedState = localStorage.getItem(STORAGE_KEY);
        if (storedState) {
          try {
            return JSON.parse(storedState);
          } catch (e) {
            console.error("Error parsing localStorage state:", e);
            // Fallback to default if parsing fails
            localStorage.removeItem(STORAGE_KEY);
          }
        }
        // Initialize default state
        return {
          features: JSON.parse(JSON.stringify(defaultFeatures)), // Deep copy defaults
          userVotes: {}, // { featureId: true }
          userSuggested: false,
        };
      }

      // Save state to localStorage
      function saveState(state) {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        } catch (e) {
          console.error("Error saving state to localStorage:", e);
          alert(
            "Could not save changes. Local storage might be full or disabled."
          );
        }
      }

      let state = loadState();

      // Function to render a single feature item
      function renderFeature(id, featureData, userHasVoted) {
        const item = document.createElement("div");
        item.classList.add("feature-item");
        item.setAttribute("data-feature-id", id);

        const votes = featureData.votes || 0;
        const name = featureData.name || id; // Use ID as name if name is missing
        const width = Math.min(votes, 100); // Cap width at 100

        item.innerHTML = `
              <span class="feature-name">${escapeHTML(name)}</span>
              <div class="feature-bar-container">
                  <div class="feature-bar" style="width: ${width}%;">
                      <div class="feature-bar-end"></div>
                  </div>
              </div>
              <span class="feature-votes">${votes}</span>
          `;

        // Add class/style if user already voted for this
        if (userHasVoted) {
          item.classList.add("voted");
          // Example: Change cursor or opacity slightly
          item.style.cursor = "default";
          item.style.opacity = "0.7";
        }

        // Assign color based on ID (simple mapping)
        const colors = { ocr: "#1f78b4", claude: "#ff7f00", pdf: "#33a02c" };
        const defaultColor = "#6a3d9a"; // Purple for others/new
        const bar = item.querySelector(".feature-bar");
        const barEnd = item.querySelector(".feature-bar-end");
        const color = colors[id] || defaultColor;
        if (bar) bar.style.backgroundColor = color;
        if (barEnd) barEnd.style.backgroundColor = color;

        return item;
      }

      // Function to render the entire list
      function renderList() {
        if (!featureListContainer) return;
        featureListContainer.innerHTML = ""; // Clear existing list

        // Sort features by votes descending (optional)
        const sortedIds = Object.keys(state.features).sort((a, b) => {
          return (
            (state.features[b].votes || 0) - (state.features[a].votes || 0)
          );
        });

        sortedIds.forEach((id) => {
          const featureElement = renderFeature(
            id,
            state.features[id],
            state.userVotes[id]
          );
          featureListContainer.appendChild(featureElement);
        });

        // Check if user has already suggested a feature and disable form
        if (state.userSuggested && addFeatureInput && addFeatureButton) {
          addFeatureInput.disabled = true;
          addFeatureInput.placeholder = "You have already suggested a feature.";
          addFeatureButton.disabled = true;
        }
      }

      // Handle voting clicks using event delegation
      function handleVoteClick(event) {
        const featureItem = event.target.closest(".feature-item");
        if (!featureItem) return;

        const featureId = featureItem.getAttribute("data-feature-id");

        // Check if already voted
        if (state.userVotes[featureId]) {
          // Maybe provide visual feedback like a subtle shake?
          featureItem.style.transform = "translateX(-2px)";
          setTimeout(() => {
            featureItem.style.transform = "translateX(0)";
          }, 150);
          return;
        }

        // Update state
        state.features[featureId].votes =
          (state.features[featureId].votes || 0) + 1;
        state.userVotes[featureId] = true;

        // Save and re-render
        saveState(state);
        renderList(); // Re-render to update styles and order
      }

      // Handle adding a new feature
      function handleAddFeature(event) {
        event.preventDefault();
        if (!addFeatureInput || state.userSuggested) return; // Already suggested or input missing

        const featureName = addFeatureInput.value.trim();

        if (featureName === "" || featureName.length > 50) {
          alert("Please enter a valid feature name (max 50 chars).");
          return;
        }

        // Create a simple ID from the name (replace spaces, lowercase)
        // NOTE: This is basic and might cause collisions if names are similar.
        // A more robust approach might use a timestamp or random string.
        const featureId = featureName
          .toLowerCase()
          .replace(/\s+/g, "-")
          .replace(/[^a-z0-9-]/g, "");

        if (!featureId) {
          alert("Could not create a valid ID for the feature name.");
          return;
        }

        if (state.features[featureId]) {
          alert("A feature with a similar name already exists.");
          return;
        }

        // Update state
        state.features[featureId] = { name: featureName, votes: 1 };
        state.userVotes[featureId] = true; // User who adds it automatically votes for it
        state.userSuggested = true;

        // Save and re-render
        saveState(state);
        renderList(); // Re-render to add the new feature and disable form

        // Clear input (though it will be disabled now)
        addFeatureInput.value = "";
      }

      // Utility to escape HTML to prevent XSS from user input
      function escapeHTML(str) {
        const div = document.createElement("div");
        div.appendChild(document.createTextNode(str));
        return div.innerHTML;
      }

      // Initial Render and Event Listeners
      document.addEventListener("DOMContentLoaded", () => {
        renderList();

        if (featureListContainer) {
          featureListContainer.addEventListener("click", handleVoteClick);
        }

        if (addFeatureFormElement) {
          addFeatureFormElement.addEventListener("submit", handleAddFeature);
        }
      });

      // --- End Local Storage Enhanced Features Logic ---
    </script>
  </body>
</html>
